pkg load optim

% Параметры
a11 = 20;     a12 = 10;     a13 = 25;
a21 = 8;      a22 = 20;     a23 = 10;
b1 = 0.120;   b2 = 0.180;   b3 = 0.210;
c1 = 0.010;   c2 = 0.005;   c3 = 0.008;
d1 = 15;      d2 = 15;      d3 = 20;

% Матрица ограничений A и вектор правых частей B
A = [
    1/a11, 1/a12, 1/a13, 0, 0, 0; % Ограничение по времени станков 1-го типа (максимум 30000 часов)
    0, 0, 0, 1/a21, 1/a22, 1/a23, % Ограничение по времени станков 2-го типа (максимум 45000 часов)
    b1, b2, b3, b1, b2, b3, % Ограничение по расходу пряжи (максимум 30000 кг)
    c1, c2, c3, c1, c2, c3, % Ограничение по расходу красителей (максимум 1000 кг)
    -b1, -b2, -b3, -b1, -b2, -b3 % Условие на использование не менее 3/4 пряжи (минимум 22500 кг)
];

B = [
    30000; % Ограничение по времени станков 1-го типа
    45000; % Ограничение по времени станков 2-го типа
    30000; % Ограничение по расходу пряжи
    1000;  % Ограничение по расходу красителей
    -22500 % Условие на использование не менее 3/4 пряжи
];

% Исходные данные
max_revenue = 3000000;  % Примерная максимальная возможная выручка
max_yarn = 30000;       % Максимальный расход пряжи

% Весовые коэффициенты (сумма = 1)
w_revenue = 0.5;        % Важность выручки (70%)
w_yarn = 0.5;           % Важность экономии пряжи (30%)

% Нормализованные коэффициенты целевой функции
% F = w_revenue*(выручка/max_revenue) - w_yarn*(пряжа/max_yarn) -> max
% Преобразуем к виду для linprog: c'x -> min
f = [
    (-w_revenue*d1/max_revenue + w_yarn*b1/max_yarn);   % x11
    (-w_revenue*d2/max_revenue + w_yarn*b2/max_yarn);   % x12
    (-w_revenue*d3/max_revenue + w_yarn*b3/max_yarn);   % x13
    (-w_revenue*d1/max_revenue + w_yarn*b1/max_yarn);   % x21
    (-w_revenue*d2/max_revenue + w_yarn*b2/max_yarn);   % x22
    (-w_revenue*d3/max_revenue + w_yarn*b3/max_yarn)    % x23
];

% Решение задачи линейного программирования
[x, fval] = linprog(f, A, B, [], [], zeros(6, 1), []);

% Расчет и денормализация результатов
revenue = d1*(x(1)+x(4)) + d2*(x(2)+x(5)) + d3*(x(3)+x(6));
yarn = b1*(x(1)+x(4)) + b2*(x(2)+x(5)) + b3*(x(3)+x(6));
norm_revenue = revenue/max_revenue;
norm_yarn = yarn/max_yarn;


% Вывод результатов
disp('=== ОПТИМАЛЬНЫЙ ПЛАН ПРОИЗВОДСТВА ===');
disp('Количество метров ткани, произведенное на каждом типе станков:');
disp('На станках 1-го типа:');
fprintf('  - Ткань артикула 1: %.2f м\n', x(1));
fprintf('  - Ткань артикула 2: %.2f м\n', x(2));
fprintf('  - Ткань артикула 3: %.2f м\n', x(3));
disp('На станках 2-го типа:');
fprintf('  - Ткань артикула 1: %.2f м\n', x(4));
fprintf('  - Ткань артикула 2: %.2f м\n', x(5));
fprintf('  - Ткань артикула 3: %.2f м\n', x(6));

disp(' ');
disp('Абсолютные показатели:');
fprintf('Выручка: %.2f руб. (%.1f%% от максимума)\n', revenue, 100*revenue/max_revenue);
fprintf('Расход пряжи: %.2f кг (%.1f%% от максимума)\n\n', yarn, 100*yarn/max_yarn);

disp('Нормализованные показатели:');
fprintf('Выручка: %.4f\n', norm_revenue);
fprintf('Расход пряжи: %.4f\n', norm_yarn);
fprintf('Целевая функция: %.4f (%.0f%% выручка, %.0f%% экономия)\n',...
        -fval, 100*w_revenue, 100*w_yarn);
