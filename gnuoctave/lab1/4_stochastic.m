pkg load optim
pkg load statistics

% Параметры
a11 = 20;     a12 = 10;     a13 = 25;
a21 = 8;      a22 = 20;     a23 = 10;
b1 = 0.120;   b2 = 0.180;   b3 = 0.210;
c1 = 0.010;   c2 = 0.005;   c3 = 0.008;
d1 = 15;      d2 = 15;      d3 = 20;

% Матрица ограничений A и вектор правых частей B
A = [
    1/a11, 1/a12, 1/a13, 0, 0, 0; % Ограничение по времени станков 1-го типа (максимум 30000 часов)
    0, 0, 0, 1/a21, 1/a22, 1/a23; % Ограничение по времени станков 2-го типа (максимум 45000 часов)
    b1, b2, b3, b1, b2, b3; % Ограничение по расходу пряжи (максимум 30000 кг)
    c1, c2, c3, c1, c2, c3; % Ограничение по расходу красителей (максимум 1000 кг)
    -b1, -b2, -b3, -b1, -b2, -b3; % Условие на использование не менее 3/4 пряжи (минимум 22500 кг)
];

B = [
    30000; % Ограничение по времени станков 1-го типа
    45000; % Ограничение по времени станков 2-го типа
    30000; % Ограничение по расходу пряжи
    1000;  % Ограничение по расходу красителей
    -22500 % Условие на использование не менее 3/4 пряжи
];

% Решение стохастической задачи
alpha = 0.1:0.1:0.9;
Ka = norminv(1 - alpha, 0, 1); % Квантили нормального распределения

x_opt = zeros(6, numel(alpha));
for i = 1:numel(alpha)
    K = Ka(i);
    A_stochastic = A + (K * 0.1 * randn(size(A)));
    [x, fval] = linprog([-d1, -d2, -d3, -d1, -d2, -d3]', A_stochastic, B, [], [], zeros(6,1), []);
    x_opt(:, i) = x;
end

% Решение детерминированной задачи
MdA = A; % Математическое ожидание матрицы A
DdA = 0.09; % Дисперсия матрицы A
[x_det, fval_det] = linprog([-d1, -d2, -d3, -d1, -d2, -d3]', MdA, B, [], [], zeros(6,1), []);

% Вывод результатов стохастической задачи
fprintf('Оптимальные объемы производства для разных значений alpha:\n');
for i = 1:numel(alpha)
    % Вычисление выручки и затрат пряжи
    revenue = d1 * x_opt(1, i) + d2 * x_opt(2, i) + d3 * x_opt(3, i) + d1 * x_opt(4, i) + d2 * x_opt(5, i) + d3 * x_opt(6, i);
    yarn_cost = b1 * x_opt(1, i) + b2 * x_opt(2, i) + b3 * x_opt(3, i) + b1 * x_opt(4, i) + b2 * x_opt(5, i) + b3 * x_opt(6, i);

    % Вывод значений текущего alpha
    fprintf('alpha = %.1f: z1 = %.2f, z2 = %.2f, N11 = %.2f, N12 = %.2f, N13 = %.2f, N21 = %.2f, N22 = %.2f, N23 = %.2f\n', ...
        alpha(i), revenue, yarn_cost, x_opt(1, i), x_opt(2, i), x_opt(3, i), x_opt(4, i), x_opt(5, i), x_opt(6, i));
end

% Вычисление выручки и затрат пряжи для детерминированной задачи
revenue_det = d1 * x_det(1) + d2 * x_det(2) + d3 * x_det(3) + d1 * x_det(4) + d2 * x_det(5) + d3 * x_det(6);
yarn_cost_det = b1 * x_det(1) + b2 * x_det(2) + b3 * x_det(3) + b1 * x_det(4) + b2 * x_det(5) + b3 * x_det(6);

% Вывод результатов детерминированной задачи
fprintf('Для детерминированных ограничений:\n');
fprintf('z1 = %.2f, z2 = %.2f, N11 = %.2f, N12 = %.2f, N13 = %.2f, N21 = %.2f, N22 = %.2f, N23 = %.2f\n', ...
    revenue_det, yarn_cost_det, x_det(1), x_det(2), x_det(3), x_det(4), x_det(5), x_det(6));
