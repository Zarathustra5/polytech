pkg load optim

% Параметры
a11 = 20;     a12 = 10;     a13 = 25;
a21 = 8;      a22 = 20;     a23 = 10;
b1 = 0.120;   b2 = 0.180;   b3 = 0.210;
c1 = 0.010;   c2 = 0.005;   c3 = 0.008;
d1 = 15;      d2 = 15;      d3 = 20;

% Матрица ограничений A и вектор правых частей B
A = [
    1/a11, 1/a12, 1/a13, 0, 0, 0; % Ограничение по времени станков 1-го типа (максимум 30000 часов)
    0, 0, 0, 1/a21, 1/a22, 1/a23, % Ограничение по времени станков 2-го типа (максимум 45000 часов)
    b1, b2, b3, b1, b2, b3, % Ограничение по расходу пряжи (максимум 30000 кг)
    c1, c2, c3, c1, c2, c3, % Ограничение по расходу красителей (максимум 1000 кг)
    -b1, -b2, -b3, -b1, -b2, -b3 % Условие на использование не менее 3/4 пряжи (минимум 22500 кг)
];

B = [
    30000; % Ограничение по времени станков 1-го типа
    45000; % Ограничение по времени станков 2-го типа
    30000; % Ограничение по расходу пряжи
    1000;  % Ограничение по расходу красителей
    -22500 % Условие на использование не менее 3/4 пряжи
];


lb = zeros(6, 1);  % Объемы производства ≥ 0
ub = [];           % Верхние границы не ограничены

% Шаг 1: Максимизация выручки (главный критерий)
f_rev = -[d1; d2; d3; d1; d2; d3];  % Минимизация отрицательной выручки
[x_opt, max_rev] = linprog(f_rev, A, B, [], [], lb, ub);
max_revenue = -max_rev;

% Шаг 2: Определение уступки по выручке (5%)
concession = 0.05;
min_revenue = max_revenue * (1 - concession);

% Добавление ограничения на выручку
A_concession = [A; -d1, -d2, -d3, -d1, -d2, -d3];
B_concession = [B; -min_revenue];

% Шаг 3: Минимизация расхода пряжи с уступкой
f_yarn = [b1; b2; b3; b1; b2; b3];
[x_opt_concession, min_yarn] = linprog(f_yarn, A_concession, B_concession, [], [], lb, ub);

% Расчет результатов
revenue_concession = d1*(x_opt_concession(1) + x_opt_concession(4)) + ...
                     d2*(x_opt_concession(2) + x_opt_concession(5)) + ...
                     d3*(x_opt_concession(3) + x_opt_concession(6));

yarn_concession = b1*(x_opt_concession(1) + x_opt_concession(4)) + ...
                  b2*(x_opt_concession(2) + x_opt_concession(5)) + ...
                  b3*(x_opt_concession(3) + x_opt_concession(6));

% Вывод результатов
disp('=== МЕТОД ПОСЛЕДОВАТЕЛЬНЫХ УСТУПОК ===');
disp('1. Решение без уступок (максимизация выручки):');
fprintf('Выручка: %.2f руб.\n', max_revenue);
fprintf('Расход пряжи: %.2f кг\n\n', ...
        b1*(x_opt(1) + x_opt(4)) + b2*(x_opt(2) + x_opt(5)) + b3*(x_opt(3) + x_opt(6)));

disp('2. Решение с уступкой 5% по выручке:');
fprintf('Выручка: %.2f руб. (уступка %.2f%%)\n', revenue_concession, concession * 100);
fprintf('Расход пряжи: %.2f кг (улучшение на %.2f кг)\n', yarn_concession, ...
        (b1*(x_opt(1) + x_opt(4)) + b2*(x_opt(2) + x_opt(5)) + b3*(x_opt(3) + x_opt(6))) - yarn_concession);

disp(' ');
disp('=== ОПТИМАЛЬНЫЙ ПЛАН ПРОИЗВОДСТВА С УСТУПКОЙ ===');
disp('Количество метров ткани, произведенное на каждом типе станков:');
disp('На станках 1-го типа:');
fprintf('  - Ткань артикула 1: %.2f м\n', x_opt_concession(1));
fprintf('  - Ткань артикула 2: %.2f м\n', x_opt_concession(2));
fprintf('  - Ткань артикула 3: %.2f м\n', x_opt_concession(3));
disp('На станках 2-го типа:');
fprintf('  - Ткань артикула 1: %.2f м\n', x_opt_concession(4));
fprintf('  - Ткань артикула 2: %.2f м\n', x_opt_concession(5));
fprintf('  - Ткань артикула 3: %.2f м\n', x_opt_concession(6));
